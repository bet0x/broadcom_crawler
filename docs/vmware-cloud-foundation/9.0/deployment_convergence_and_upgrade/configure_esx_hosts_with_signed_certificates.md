---
source_url: https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-9-0-and-later/9-0/deployment/deploying-a-new-vmware-cloud-foundation-or-vmware-vsphere-foundation-private-cloud-/preparing-your-environment/preparing-esx-hosts-for-vmware-cloud-foundation-or-vmware-vsphere-foundation/configure-esxi-hosts-with-signed-certificates.html
product: vmware-cloud-foundation
version: 9.0
section: Deployment, Convergence, and Upgrade
breadcrumb: Deployment, Convergence, and Upgrade > Configure ESX Hosts with Signed Certificates
---

# Configure ESX Hosts with Signed Certificates

If corporate policy requires that you use external CA-signed certificates instead of VMCA-signed certificates for ESX hosts, you can manually add external certificates to the hosts.

External CA-signed certificate and key are available.

When you install ESX software on a server to create an ESX host, the host initially has an autogenerated certificate. By default, when the ESX host is added to a vSphere cluster during deployment of the management domain or other operations involving ESX hosts (for example, host commissioning, workload domain creation, and so on), the autogenerated certificate is replaced with a certificate that is signed by the VMware Certificate Authority (VMCA).

When you use external certificates during deployment, they are not replaced by VMCA-signed certificates. Once you perform deployment with external certificates for ESX hosts, all future ESX hosts added to VCF must also use external certificates.

To deploy the management domain using external certificates, you must use a JSON specification file with the VCF Installer. You cannot use the VCF Installer deployment wizard. In the JSON specification file, use the SecuritySpec section in the SddcSpec to specify a value of Custom for esxiCertsMode. For example:

```
"securitySpec" : {
"esxiCertsMode" : "Custom",
"rootCaCerts" : [ {
"alias" : "Rainpole-CA",
"certChain" : [ "-----BEGIN CERTIFICATE-----
MICDczCCAlugAwIBAgIQI9xwbTkI9J5GhMffcP5CHDANBgkqhkiG9w0BAQsFADBM
MRIwEAYKCZImiZPyLGQBGRYCaW8xGDAWBgoJkiaJk/IsZAEZFghyYWlucG9sZTEc
MBoGA1UEAxMTcmFpbnBvbGUtZGMwMXJwbC1DQTAeFw0yMDAzMzAxNDQ2MTNaFw0y
NTAzMzAxNDU2MTNaMEwxEjAQBgoJkiaJk/IsZAEZFgJpbzEYMBYGCgmSJomT8ixk
ARkWCHJhaW5wb2xlMRwwGgYDVQQDExNyYWlucG9sZS1kYzAxcnBsLUNBMIIBIjAN
BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzpwkz7aPlQcfevcCelHc9DPswHkd
kjY96Vh3GvYlesaVEcy/q/BOvvh3KgLMLy8r7cy2cNPO3FANKOfqVdVx3ghfEUyL
g61W9BskAlwryzJRmjhOJJVqvB8CWjy+eCp7MejHGdEud6WdEvK8CaBcPngEg0KM
eLRNLGe8OCw8yY4GTrjU+H7PYQZtyD0kxxy5f47ueaDXat4ENRGcAuHEfCoMGfaR
bDue1OO4diHd900bCym5ggBNX0jhRudNULXPTayZl2ksImV0+QkaVeptQImXfCgb
kgnHQJ5CxK26up7fB5eAsmGLAsJLBnHuM7P9xvV09EvWjFCgLX/oBBDYTQIDAQAB
o1EwTzALBgNVHQ8EBAMCAYYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQU7oOq
QBK8yg8mHnAfb+u6/GO0ZUcwEAYJKwYBBAGCNxUBBAMCAQAwDQYJKoZIhvcNAQEL
BQADggEBALYxZGj4vWjFDN1atOUsBx2jrmxbExgMAyRpNlSc2aj+7vzxHxUW5VbX
x9nc/BfkTiCK6c7Y9VYb+mgjb8z0kNv58sT4ar1yIl1n63VOCoyyLcaFB8HyEJpD
wUhz4RNPoSijZMpm+M5EuSLfWlhEJo7N8sLqHgvvk1dFpbK8fIHbPS5KJwJibbPe
w9UuNRdcxN9hFWKBC0SvfgX+1CJxVdvgfi65rSHPuWinJzrXXdH999DfpDESRzwH
0pqE3GtMCt1Nqalp2QJFdahbT+kxj7QWHTjUylSENDHjdln7a8WH8RGxvEy/97YZ
+crXmxvQ/bAgHk9vcRERbRjfyIs7v88=
-----END CERTIFICATE-----" ] } ] }
```

See the [VCF Installer API Reference Guide](https://developer.broadcom.com/xapis/vcf-installer-api/latest/v1/sddcs/post/) for more information.

1. In a web browser, log in to the ESX host using the VMware Host Client.
2. In the navigation pane, click Manage and click the Services tab.

   ![The Services tab for an ESX host in the VMware Host Client.](/content/broadcom/techdocs/us/en/vmware-cis/vcf/vcf-9-0-and-later/9-0/_jcr_content/assetversioncopies/0ecc319a-a6e9-494b-8789-4a73cb81adc1.original.png)
3. Select the TSM-SSH service and click Start if not started.
4. Log in to the ESX Shell for the first host, either directly from the DCUI or from an SSH client, as a user with administrator privileges.
5. In the directory /etc/vmware/ssl, rename the existing certificates using the following commands:

   ```
   mv rui.crt orig.rui.crt
   ```

   ```
   mv rui.key orig.rui.key
   ```
6. Copy the external certificate and key that you want to use to /etc/vmware/ssl.
7. Rename the external certificate and key to rui.crt and rui.key.
8. Restart the host management agents by running the following commands:

   ```
   /etc/init.d/hostd restart
   ```

   ```
   /etc/init.d/vpxa restart
   ```
9. In the VMware Host Client, select the TSM-SSH service for the ESX host and click Stop.
10. Repeat for all the ESX hosts that you are adding to VMware Cloud Foundation.